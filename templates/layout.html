<html>
	<head>

	    <meta charset="utf-8">

	    <title>
		    {% block TITLE_BLOCK %}
			    2NMS - network tools
		    {% endblock %}
	    </title>

	    <link rel="shortcut icon" href="/favicon.ico">

		<!-- UIkit CSS -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-beta.28/css/uikit.min.css" />

	    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

		{% include 'scripts/cookie_consent.html' %}

	</head>


	<body>

		<!-- top section -->
		{% block BLOCK_TOPSECTION %}
		<div class="uk-section-secondary uk-preserve-color">
			<!-- navigation bar -->
			{% set active_page = "ping" %}
			{% include 'navbar.html' %}

			<!-- command bar -->
			{% set command = "ping" %}
			{% set command_title = "Ping (IPv4)" %}			
			{% include 'command.html' %}
		</div>
		{% endblock %}

		<!-- command result section -->
		{% include 'command_result.html' %}

		<!-- tools overview section -->
		{% include 'tools.html' %}

		<!-- footer section -->
		{% include 'footer.html' %}
		{% include 'copyright.html' %}

		<!-- modals -->
		{% include 'modal_ipaddress_notification.html' %}
		{% include 'modal_port_notification.html' %}


		<!-- jQuery is required -->
		<script src="{{ url_for('static', filename='assets/jquery-v3.2.1/jquery-3.2.1.min.js') }}"></script>

		<!-- UIkit JS -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-beta.28/js/uikit.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-beta.28/js/uikit-icons.min.js"></script>

		<script src="{{ url_for('static', filename='js/validate_ipv4.js') }}"></script>
		<script src="{{ url_for('static', filename='js/validate_port.js') }}"></script>

		{% block BLOCK_COMMAND_JAVASCRIPT %}
	    <script>

			function ping() {
                var ip = $("#ipaddress").val();

                if (!validate_ipv4(ip)) {
                	var modal = UIkit.modal("#modal-ipaddress-notification");
				  	$("#ipaddress").removeClass('uk-form-success').addClass('uk-form-danger');
				  	modal.show();
                	//alert("Enter a valid IPv4 address");
                	return (false)
                }

                $("#output").empty();
			  	$("#ipaddress").removeClass('uk-form-danger').addClass('uk-form-success');
                $("#output-title").text("Ping result for: "+ip);
                $("#command-result-section").show();

				var url = "{{ url_for('public.streamed_response_ping', ipaddress='') }}" + ip;
				var source = new EventSource(url);

				source.onmessage = function(event){
					eofstream = /.*END STREAM.*/;
					if ((event.data).match(eofstream)) {
						console.log(event.data);
						source.close();
					}
					else {
						reFail = / [^0]% loss/;
						var ping_class = "ping-success";
						if ((event.data).match(reFail)) {
							var ping_class = "ping-fail";
						};
						$("#output").append('<span class="'+ping_class+'">'+event.data+"</span><br/>");
					}
				};


			}

		</script>
		{% endblock %}

		{# INSERT GOOGLE ANALYTICS CODE IF THE TRACKING ID IS CONFIGURED #}
		{% if config.GOOGLE_ANALYTICS_TRACKID|length > 0 %}
			{% include 'scripts/google_analytics.html' %}
		{% endif %}
	</body>
</html>
